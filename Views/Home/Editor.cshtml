@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>知乎风编辑器</title>

    @*  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js"></script> *@

    <script src="//unpkg.com/tinymce@4.8.0/tinymce.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont;
        }

        .editor-page {
            display: flex;
            height: 100vh;
        }

        .editor-sidebar {
            width: 240px;
            border-right: 1px solid #e5e6eb;
            padding: 12px;
            background: #fff;
            overflow-y: auto;
        }

        .editor-main {
            flex: 1;
            padding: 12px;
        }

        .editor-sidebar li {
            cursor: pointer;
            padding: 4px 0;
        }

        .tox-tinymce {
            height: 100% !important;
        }
    </style>
</head>

<body>
    <form method="post" asp-action="Save">

        <div class="editor-page">
            <div class="editor-sidebar">
                <strong>文章大纲</strong>
                <ul id="outlineList"></ul>
            </div>

            <div class="editor-main">
                <textarea id="editor" name="content"></textarea>
                <button type="submit">保存</button>
            </div>
        </div>

    </form>

    <script>
        tinymce.init({
            selector: '#editor',
            height: '100%',
            menubar: false,
            plugins: 'lists link image code',
            toolbar: 'undo redo | h1 h2 h3 | bold italic | bullist numlist | code',

            setup: function (editor) {
                editor.on('Change KeyUp', function () {
                    updateOutline(editor);
                });
            }
        });

        function updateOutline(editor) {
            const outline = document.getElementById('outlineList');
            outline.innerHTML = '';

            editor.getBody().querySelectorAll('h1,h2,h3,h4,h5,h6').forEach(h => {
                const li = document.createElement('li');
                li.innerText = h.innerText;
                li.onclick = () => {
                    editor.selection.select(h);
                    editor.selection.scrollIntoView(h);
                };
                outline.appendChild(li);
            });
        }
    </script>

</body>
</html>
